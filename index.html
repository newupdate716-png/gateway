// ==================== API.JS - SMS MONITOR (Vercel Edition) ====================
// Author: SMS Monitor System
// Version: 2.0 (Pure JavaScript, Serverless Ready)
// Hosting: Vercel, Netlify, GitHub Pages (Fully Static + API)

// Data storage using localStorage (or can be replaced with Vercel KV/PostgreSQL)
// For production, you can integrate with: Vercel KV (Redis), Supabase, or MongoDB

// Configuration
const CONFIG = {
    APP_NAME: 'ðŸ’Ž Premium SMS Monitor',
    VERSION: '2.0',
    DB_KEY: 'sms_monitor_db',
    AUTO_REFRESH: 30000, // 30 seconds
    PENDING_STATUS: 'PENDING',
    COMPLETED_STATUS: 'COMPLETED'
};

// ==================== DATABASE LAYER (localStorage) ====================
class Database {
    constructor() {
        this.initDatabase();
    }

    initDatabase() {
        if (!localStorage.getItem(CONFIG.DB_KEY)) {
            const initialData = {
                transactions: [],
                backup_sms: [],
                stats: {
                    total_transactions: 0,
                    today_transactions: 0,
                    total_amount: 0,
                    pending_transactions: 0,
                    completed_transactions: 0,
                    service_distribution: {}
                }
            };
            localStorage.setItem(CONFIG.DB_KEY, JSON.stringify(initialData));
        }
    }

    getDB() {
        return JSON.parse(localStorage.getItem(CONFIG.DB_KEY));
    }

    saveDB(db) {
        localStorage.setItem(CONFIG.DB_KEY, JSON.stringify(db));
        this.updateStats(db);
    }

    updateStats(db) {
        const today = new Date().toDateString();
        let totalAmount = 0;
        let pendingCount = 0;
        let completedCount = 0;
        let todayCount = 0;
        let serviceDist = {};

        db.transactions.forEach(t => {
            // Count by status
            if (t.status === CONFIG.PENDING_STATUS) pendingCount++;
            else if (t.status === CONFIG.COMPLETED_STATUS) completedCount++;

            // Today's transactions
            if (new Date(t.timestamp).toDateString() === today) {
                todayCount++;
            }

            // Total amount (completed only)
            if (t.status === CONFIG.COMPLETED_STATUS && t.amount) {
                const amt = parseFloat(t.amount.toString().replace(/[^0-9.]/g, ''));
                if (!isNaN(amt)) totalAmount += amt;
            }

            // Service distribution (completed only)
            if (t.status === CONFIG.COMPLETED_STATUS && t.service_type) {
                const service = t.service_type;
                serviceDist[service] = (serviceDist[service] || 0) + 1;
            }
        });

        db.stats = {
            total_transactions: db.transactions.length,
            today_transactions: todayCount,
            total_amount: totalAmount.toFixed(2),
            pending_transactions: pendingCount,
            completed_transactions: completedCount,
            service_distribution: serviceDist
        };

        localStorage.setItem(CONFIG.DB_KEY, JSON.stringify(db));
    }

    // ==================== TRANSACTION METHODS ====================
    saveTransaction(transactionData, ip = '0.0.0.0') {
        const db = this.getDB();

        // Check for duplicate transaction ID
        if (transactionData.transaction_id) {
            const existing = db.transactions.find(t => 
                t.transaction_id === transactionData.transaction_id
            );
            if (existing) {
                return { 
                    success: true, 
                    message: 'Transaction already exists',
                    status: existing.status 
                };
            }
        }

        // Create new transaction
        const newTransaction = {
            id: Date.now() + '-' + Math.random().toString(36).substr(2, 9),
            sender: transactionData.sender || '',
            amount: transactionData.amount || '',
            transaction_id: transactionData.transaction_id || '',
            account_number: transactionData.account_number || '',
            reference: transactionData.reference || '',
            service_type: transactionData.service_type || 'Other',
            transaction_type: transactionData.transaction_type || 'Unknown',
            timestamp: new Date().toISOString(),
            sim_info: transactionData.sim_info || '',
            original_message: transactionData.original_message || '',
            ip_address: ip,
            device_info: navigator.userAgent,
            status: CONFIG.PENDING_STATUS,
            verified_at: null,
            verified_by: null
        };

        db.transactions.unshift(newTransaction); // Add to beginning
        this.saveDB(db);
        return { success: true, message: 'Transaction saved as PENDING' };
    }

    saveBackup(smsData, ip = '0.0.0.0') {
        const db = this.getDB();
        db.backup_sms.unshift({
            id: Date.now() + '-' + Math.random().toString(36).substr(2, 9),
            sms_data: smsData,
            timestamp: new Date().toISOString(),
            ip_address: ip
        });
        // Keep only last 100 backup SMS to prevent storage overflow
        if (db.backup_sms.length > 100) db.backup_sms.pop();
        this.saveDB(db);
        return { success: true };
    }

    getStatistics() {
        const db = this.getDB();
        
        // Format service distribution for display
        const serviceDistArray = Object.entries(db.stats.service_distribution)
            .map(([service_type, count]) => ({ service_type, count }))
            .sort((a, b) => b.count - a.count);

        // Get recent transactions (last 50)
        const recentTransactions = db.transactions.slice(0, 50);

        return {
            total_transactions: db.stats.total_transactions,
            today_transactions: db.stats.today_transactions,
            total_amount: db.stats.total_amount,
            service_distribution: serviceDistArray,
            recent_transactions: recentTransactions,
            pending_transactions: db.stats.pending_transactions,
            completed_transactions: db.stats.completed_transactions
        };
    }

    // ==================== VERIFICATION METHODS ====================
    verifyPayment(service, amount, txid) {
        const db = this.getDB();
        const cleanAmount = parseFloat(amount.toString().replace(/[^0-9.]/g, '')).toString();

        // Find PENDING transaction
        const transaction = db.transactions.find(t => 
            t.status === CONFIG.PENDING_STATUS &&
            t.service_type?.toLowerCase() === service.toLowerCase() &&
            t.transaction_id === txid &&
            parseFloat(t.amount?.toString().replace(/[^0-9.]/g, '') || '0').toString() === cleanAmount
        );

        if (transaction) {
            transaction.status = CONFIG.COMPLETED_STATUS;
            transaction.verified_at = new Date().toISOString();
            transaction.verified_by = 'API';
            this.saveDB(db);
            return {
                success: true,
                matched_records: 1,
                message: 'Transaction verified and marked as COMPLETED',
                status: CONFIG.COMPLETED_STATUS
            };
        } else {
            // Check if exists but not PENDING
            const existing = db.transactions.find(t => 
                t.service_type?.toLowerCase() === service.toLowerCase() &&
                t.transaction_id === txid
            );

            if (existing) {
                return {
                    success: false,
                    error: 'TRANSACTION_NOT_PENDING',
                    message: 'Transaction found but not in PENDING state',
                    status: existing.status
                };
            } else {
                return {
                    success: false,
                    error: 'NO_MATCH',
                    message: 'No matching PENDING transaction found'
                };
            }
        }
    }

    verifyPaymentWithoutTxid(service, amount) {
        const db = this.getDB();
        const cleanAmount = parseFloat(amount.toString().replace(/[^0-9.]/g, '')).toString();

        // Find most recent PENDING transaction with matching service and amount
        const transaction = db.transactions.find(t => 
            t.status === CONFIG.PENDING_STATUS &&
            t.service_type?.toLowerCase() === service.toLowerCase() &&
            parseFloat(t.amount?.toString().replace(/[^0-9.]/g, '') || '0').toString() === cleanAmount
        );

        if (transaction) {
            transaction.status = CONFIG.COMPLETED_STATUS;
            transaction.verified_at = new Date().toISOString();
            transaction.verified_by = 'API';
            this.saveDB(db);
            return {
                success: true,
                matched_records: 1,
                transaction_id: transaction.transaction_id,
                message: 'Transaction verified and marked as COMPLETED',
                status: CONFIG.COMPLETED_STATUS
            };
        } else {
            return {
                success: false,
                error: 'NO_MATCH',
                message: 'No matching PENDING transaction found'
            };
        }
    }

    checkTransactionStatus(txid) {
        const db = this.getDB();
        const transaction = db.transactions.find(t => t.transaction_id === txid);
        
        if (transaction) {
            return {
                success: true,
                status: transaction.status,
                verified_at: transaction.verified_at
            };
        } else {
            return {
                success: false,
                error: 'Transaction not found'
            };
        }
    }

    clearDatabase() {
        localStorage.removeItem(CONFIG.DB_KEY);
        this.initDatabase();
        return { success: true, message: 'Database cleared successfully' };
    }
}

// Initialize database
const db = new Database();

// ==================== API ROUTES ====================
// This function handles API requests based on URL parameters
function handleAPIRequest() {
    const urlParams = new URLSearchParams(window.location.search);
    const action = urlParams.get('action');
    const method = window.method || 'GET'; // Will be set by POST form submissions

    // Only handle POST requests via form or AJAX
    if (method === 'POST' && action) {
        let response = { success: false, error: 'Invalid action' };

        switch (action) {
            case 'save_transaction':
                const data = urlParams.get('data') || '{}';
                response = db.saveTransaction(JSON.parse(data), 'web');
                break;

            case 'save_backup':
                const smsData = urlParams.get('sms_data') || '';
                response = db.saveBackup(smsData, 'web');
                break;

            case 'get_stats':
                response = db.getStatistics();
                break;

            case 'verify_payment':
                const service = urlParams.get('service') || '';
                const amount = urlParams.get('amount') || '';
                const txid = urlParams.get('txid') || '';
                
                if (!service || !amount || !txid) {
                    response = { success: false, error: 'Missing service, amount or transaction ID' };
                } else {
                    response = db.verifyPayment(service, amount, txid);
                }
                break;

            case 'verify_payment_without_txid':
                const service2 = urlParams.get('service') || '';
                const amount2 = urlParams.get('amount') || '';
                
                if (!service2 || !amount2) {
                    response = { success: false, error: 'Missing service or amount' };
                } else {
                    response = db.verifyPaymentWithoutTxid(service2, amount2);
                }
                break;

            case 'check_transaction_status':
                const txid2 = urlParams.get('txid') || '';
                if (!txid2) {
                    response = { success: false, error: 'Missing transaction ID' };
                } else {
                    response = db.checkTransactionStatus(txid2);
                }
                break;

            case 'clear_database':
                response = db.clearDatabase();
                break;
        }

        // If this is an API call (AJAX), return JSON
        if (window.isApiCall) {
            return response;
        }
    }

    return null;
}

// ==================== UI RENDERING ====================
function renderDashboard() {
    const stats = db.getStatistics();
    const app = document.getElementById('app');
    if (!app) return;

    app.innerHTML = `
        <div class="dashboard">
            <!-- Header -->
            <div class="header">
                <div class="header-left">
                    <div class="logo">
                        <i class="fas fa-sms"></i>
                    </div>
                    <div class="title">
                        <h1>${CONFIG.APP_NAME}</h1>
                        <p>Real-time SMS Transaction Dashboard â€¢ Auto Pending System</p>
                    </div>
                </div>
                <div class="badge">
                    <i class="fas fa-shield-alt"></i> 100% Secure â€¢ Pending â†’ Completed
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon blue">
                        <i class="fas fa-exchange-alt"></i>
                    </div>
                    <div class="stat-title">Total Transactions</div>
                    <div class="stat-value" id="totalTransactions">${stats.total_transactions}</div>
                    <div class="stat-subtitle">All time transactions</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon yellow">
                        <i class="fas fa-hourglass-half"></i>
                    </div>
                    <div class="stat-title">Pending</div>
                    <div class="stat-value" id="pendingTransactions">${stats.pending_transactions}</div>
                    <div class="stat-subtitle">Awaiting verification</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon green">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-title">Completed</div>
                    <div class="stat-value" id="completedTransactions">${stats.completed_transactions}</div>
                    <div class="stat-subtitle">Verified transactions</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon orange">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-title">Today's</div>
                    <div class="stat-value" id="todayTransactions">${stats.today_transactions}</div>
                    <div class="stat-subtitle">Transactions today</div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="main-content">
                <div class="section-title">
                    <i class="fas fa-list"></i> Recent Transactions
                </div>
                
                <div class="action-bar">
                    <div class="search-container">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="search-input" placeholder="Search by number, ID, or amount..." id="searchInput">
                    </div>
                    
                    <div class="filter-buttons">
                        <button class="filter-btn active" onclick="window.filterTransactions('all')">
                            <i class="fas fa-layer-group"></i> All
                        </button>
                        <button class="filter-btn" onclick="window.filterTransactions('pending')">
                            <i class="fas fa-hourglass-half"></i> Pending
                        </button>
                        <button class="filter-btn" onclick="window.filterTransactions('completed')">
                            <i class="fas fa-check-circle"></i> Completed
                        </button>
                    </div>
                </div>
                
                <div class="transactions-table" id="transactionsTable">
                    ${renderTransactionsTable(stats.recent_transactions)}
                </div>
                
                <!-- Service Distribution -->
                ${renderServiceDistribution(stats.service_distribution)}
            </div>
            
            <!-- Footer -->
            <div class="footer">
                <p>Â© ${new Date().getFullYear()} Premium SMS Monitor System â€¢ Auto Pending System â€¢ Version ${CONFIG.VERSION}</p>
                <p style="margin-top: 10px; font-size: 12px; opacity: 0.7;">
                    <i class="fas fa-lock"></i> 100% Secure â€¢ Pending until verified â€¢ Once completed, cannot be verified again
                </p>
            </div>
        </div>
        
        <!-- Transaction Details Modal -->
        <div class="modal-overlay" id="transactionModal">
            <div class="modal">
                <div class="modal-header">
                    <div class="modal-title">
                        <i class="fas fa-receipt"></i> Transaction Details
                    </div>
                    <button class="close-btn" onclick="closeModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body" id="modalBody">
                    <!-- Dynamic content -->
                </div>
            </div>
        </div>
    `;

    attachEventListeners();
}

function renderTransactionsTable(transactions) {
    if (!transactions || transactions.length === 0) {
        return `
            <div class="no-data">
                <i class="fas fa-inbox"></i>
                <h3>No transactions found</h3>
                <p>Transactions will appear here when received via SMS</p>
            </div>
        `;
    }

    return `
        <table>
            <thead>
                <tr>
                    <th>Status</th>
                    <th>Service</th>
                    <th>Transaction ID</th>
                    <th>Amount</th>
                    <th>Sender/Receiver</th>
                    <th>Account/Reference</th>
                    <th>Type</th>
                    <th>Time</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                ${transactions.map(t => renderTransactionRow(t)).join('')}
            </tbody>
        </table>
    `;
}

function renderTransactionRow(transaction) {
    const service = (transaction.service_type || 'other').toLowerCase();
    const isReceived = (transaction.transaction_type || '').toLowerCase().includes('received');
    const status = (transaction.status || 'pending').toLowerCase();
    const rowClass = status === 'completed' ? 'status-completed-row' : 'status-pending-row';

    return `
        <tr class="${rowClass}" 
            data-service="${service}" 
            data-status="${status}"
            data-transaction='${JSON.stringify(transaction).replace(/'/g, "&apos;")}'>
            <td>
                <span class="status-badge status-${status}">
                    <i class="fas fa-${status === 'completed' ? 'check-circle' : 'hourglass-half'}"></i>
                    ${status.toUpperCase()}
                </span>
            </td>
            <td>
                <span class="service-badge ${service}">
                    <i class="fas fa-${getServiceIcon(service)}"></i>
                    ${transaction.service_type || 'Other'}
                </span>
            </td>
            <td>
                <div class="transaction-id">
                    ${transaction.transaction_id || 'N/A'}
                </div>
            </td>
            <td>
                <div class="amount ${isReceived ? 'received' : 'sent'}">
                    à§³${transaction.amount || '0.00'}
                </div>
            </td>
            <td>
                <div class="sender-info">
                    <div class="sender-number">
                        ${transaction.sender || 'N/A'}
                    </div>
                    ${transaction.account_number ? `
                    <div class="sender-name">
                        ${transaction.account_number}
                    </div>
                    ` : ''}
                </div>
            </td>
            <td>
                <div class="balance">
                    ${transaction.reference || transaction.account_number || 'N/A'}
                </div>
            </td>
            <td>
                ${transaction.transaction_type || 'N/A'}
            </td>
            <td>
                <div class="timestamp">
                    ${new Date(transaction.timestamp).toLocaleString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' })}
                </div>
            </td>
            <td>
                <button class="view-btn" onclick="viewTransaction('${transaction.id}')">
                    <i class="fas fa-eye"></i> View
                </button>
            </td>
        </tr>
    `;
}

function getServiceIcon(service) {
    const icons = {
        'bkash': 'mobile-alt',
        'nagad': 'wallet',
        'rocket': 'rocket',
        'bank': 'university'
    };
    return icons[service] || 'money-bill';
}

function renderServiceDistribution(distribution) {
    if (!distribution || distribution.length === 0) return '';

    return `
        <div class="section-title" style="margin-top: 40px;">
            <i class="fas fa-chart-pie"></i> Completed Service Distribution
        </div>
        <div class="service-distribution">
            ${distribution.map(service => {
                const serviceName = service.service_type.toLowerCase();
                const icon = getServiceIcon(serviceName);
                const colors = {
                    'bkash': '#E2136E',
                    'nagad': '#F8A61C',
                    'rocket': '#4CAF50',
                    'bank': '#3B82F6'
                };
                const bgColor = colors[serviceName] || '#8B5CF6';

                return `
                    <div class="service-item">
                        <div class="service-icon" style="background: ${bgColor};">
                            <i class="fas fa-${icon}"></i>
                        </div>
                        <div>
                            <div class="service-count">${service.count}</div>
                            <div class="service-name">${service.service_type}</div>
                        </div>
                    </div>
                `;
            }).join('')}
        </div>
    `;
}

function attachEventListeners() {
    // Search functionality
    const searchInput = document.getElementById('searchInput');
    if (searchInput) {
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const rows = document.querySelectorAll('#transactionsTable tbody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });
    }
}

// Global functions for UI interaction
window.filterTransactions = function(filter) {
    const rows = document.querySelectorAll('#transactionsTable tbody tr');
    const buttons = document.querySelectorAll('.filter-btn');
    
    buttons.forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    rows.forEach(row => {
        if (filter === 'all') {
            row.style.display = '';
        } else {
            const status = row.getAttribute('data-status');
            row.style.display = status === filter ? '' : 'none';
        }
    });
};

window.viewTransaction = function(transactionId) {
    const stats = db.getStatistics();
    const transaction = stats.recent_transactions.find(t => t.id === transactionId);
    if (!transaction) return;

    const modal = document.getElementById('transactionModal');
    const modalBody = document.getElementById('modalBody');
    
    const isReceived = (transaction.transaction_type || '').toLowerCase().includes('received');
    const service = transaction.service_type || 'Unknown';
    const status = transaction.status || 'PENDING';
    
    let detailsHTML = `
        <div class="detail-row">
            <div class="detail-label">Status:</div>
            <div class="detail-value">
                <span class="status-badge status-${status.toLowerCase()}">
                    <i class="fas fa-${status.toLowerCase() === 'completed' ? 'check-circle' : 'hourglass-half'}"></i>
                    ${status}
                </span>
            </div>
        </div>
        
        <div class="detail-row">
            <div class="detail-label">Service Provider:</div>
            <div class="detail-value">
                <span class="service-badge ${service.toLowerCase()}">
                    <i class="fas fa-${getServiceIcon(service.toLowerCase())}"></i>
                    ${service}
                </span>
            </div>
        </div>
        
        <div class="detail-row">
            <div class="detail-label">Transaction ID:</div>
            <div class="detail-value" style="font-family: monospace; font-weight: 700;">${transaction.transaction_id || 'N/A'}</div>
        </div>
        
        <div class="detail-row">
            <div class="detail-label">Amount:</div>
            <div class="detail-value" style="color: ${isReceived ? 'var(--secondary)' : 'var(--danger)'}; font-size: 20px; font-weight: 800;">
                à§³${transaction.amount || '0.00'} 
                <span style="font-size: 14px; color: var(--gray);">(${isReceived ? 'Received' : 'Sent/Payment'})</span>
            </div>
        </div>
        
        <div class="detail-row">
            <div class="detail-label">${isReceived ? 'Sender Number' : 'Receiver'}:</div>
            <div class="detail-value">${transaction.sender || 'N/A'}</div>
        </div>
        
        <div class="detail-row">
            <div class="detail-label">Account/Reference:</div>
            <div class="detail-value">${transaction.account_number || transaction.reference || 'N/A'}</div>
        </div>
        
        <div class="detail-row">
            <div class="detail-label">Transaction Type:</div>
            <div class="detail-value">${transaction.transaction_type || 'N/A'}</div>
        </div>
        
        <div class="detail-row">
            <div class="detail-label">Transaction Time:</div>
            <div class="detail-value">${new Date(transaction.timestamp).toLocaleString()}</div>
        </div>`;
        
    if (transaction.verified_at) {
        detailsHTML += `
        <div class="detail-row">
            <div class="detail-label">Verified At:</div>
            <div class="detail-value">${new Date(transaction.verified_at).toLocaleString()}</div>
        </div>`;
    }
    
    if (transaction.verified_by) {
        detailsHTML += `
        <div class="detail-row">
            <div class="detail-label">Verified By:</div>
            <div class="detail-value">${transaction.verified_by}</div>
        </div>`;
    }
    
    detailsHTML += `
        <div class="detail-row">
            <div class="detail-label">SIM Information:</div>
            <div class="detail-value">${transaction.sim_info || 'Not Available'}</div>
        </div>
        
        <div class="sms-preview">
            <div class="sms-title">
                <i class="fas fa-sms"></i> Original SMS Message
            </div>
            <div class="sms-content">${transaction.original_message || 'No original message available'}</div>
        </div>
    `;
    
    modalBody.innerHTML = detailsHTML;
    modal.style.display = 'flex';
};

window.closeModal = function() {
    document.getElementById('transactionModal').style.display = 'none';
};

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('transactionModal');
    if (event.target === modal) {
        closeModal();
    }
};

// ==================== INITIALIZATION ====================
document.addEventListener('DOMContentLoaded', () => {
    // Check if this is an API call
    if (window.location.search.includes('action=')) {
        window.isApiCall = true;
        const response = handleAPIRequest();
        if (response) {
            document.body.innerHTML = `<pre>${JSON.stringify(response, null, 2)}</pre>`;
            return;
        }
    }

    // Render dashboard
    renderDashboard();

    // Auto refresh every 30 seconds
    setInterval(() => {
        const stats = db.getStatistics();
        document.getElementById('totalTransactions').textContent = stats.total_transactions;
        document.getElementById('pendingTransactions').textContent = stats.pending_transactions;
        document.getElementById('completedTransactions').textContent = stats.completed_transactions;
        document.getElementById('todayTransactions').textContent = stats.today_transactions;
        
        // Refresh transactions table if needed
        const transactionsTable = document.getElementById('transactionsTable');
        if (transactionsTable) {
            const tbody = transactionsTable.querySelector('tbody');
            if (tbody) {
                // Simple refresh - you can enhance this
                location.reload();
            }
        }
    }, 30000);
});

// Export for use in Android app
window.SMSMonitor = {
    saveTransaction: (data) => db.saveTransaction(data),
    saveBackup: (smsData) => db.saveBackup(smsData),
    getStats: () => db.getStatistics()
};

// ==================== STYLES ====================
const style = document.createElement('style');
style.textContent = `
    :root {
        --primary: #8B5CF6;
        --secondary: #10B981;
        --danger: #EF4444;
        --warning: #F59E0B;
        --info: #3B82F6;
        --dark: #1F2937;
        --light: #F9FAFB;
        --gray: #6B7280;
        --bkash: #E2136E;
        --nagad: #F8A61C;
        --rocket: #4CAF50;
        --bank: #3B82F6;
        --border: #E5E7EB;
        --pending: #F59E0B;
        --completed: #10B981;
    }
    
    * { 
        margin: 0; 
        padding: 0; 
        box-sizing: border-box; 
        font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    }
    
    body { 
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: var(--dark);
        line-height: 1.6;
    }
    
    .dashboard {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
    }
    
    .header {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 25px 30px;
        margin-bottom: 25px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        border: 1px solid rgba(255, 255, 255, 0.3);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .header-left {
        display: flex;
        align-items: center;
        gap: 20px;
    }
    
    .logo {
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, var(--primary), #7C3AED);
        border-radius: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 28px;
    }
    
    .title h1 {
        font-size: 28px;
        font-weight: 800;
        color: var(--dark);
        margin-bottom: 5px;
    }
    
    .title p {
        color: var(--gray);
        font-size: 14px;
        font-weight: 500;
    }
    
    .badge {
        background: linear-gradient(135deg, var(--secondary), #059669);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 18px;
        padding: 25px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        border: 1px solid rgba(255, 255, 255, 0.3);
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
    }
    
    .stat-icon {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        margin-bottom: 20px;
        color: white;
    }
    
    .stat-icon.blue { background: linear-gradient(135deg, #3B82F6, #1D4ED8); }
    .stat-icon.green { background: linear-gradient(135deg, #10B981, #059669); }
    .stat-icon.purple { background: linear-gradient(135deg, #8B5CF6, #7C3AED); }
    .stat-icon.orange { background: linear-gradient(135deg, #F59E0B, #D97706); }
    .stat-icon.yellow { background: linear-gradient(135deg, #FBBF24, #F59E0B); }
    
    .stat-title {
        font-size: 14px;
        color: var(--gray);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 8px;
    }
    
    .stat-value {
        font-size: 32px;
        font-weight: 800;
        color: var(--dark);
        margin-bottom: 5px;
    }
    
    .stat-subtitle {
        font-size: 14px;
        color: var(--gray);
        font-weight: 500;
    }
    
    .main-content {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        border: 1px solid rgba(255, 255, 255, 0.3);
        margin-bottom: 30px;
    }
    
    .section-title {
        font-size: 22px;
        font-weight: 800;
        color: var(--dark);
        margin-bottom: 25px;
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .section-title i {
        color: var(--primary);
    }
    
    .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 700;
        text-transform: uppercase;
    }
    
    .status-pending {
        background: #FEF3C7;
        color: #92400E;
    }
    
    .status-completed {
        background: #D1FAE5;
        color: #065F46;
    }
    
    .action-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        flex-wrap: wrap;
        gap: 15px;
    }
    
    .search-container {
        position: relative;
        flex-grow: 1;
        max-width: 400px;
    }
    
    .search-input {
        width: 100%;
        padding: 14px 20px 14px 50px;
        border: 2px solid var(--border);
        border-radius: 12px;
        font-size: 15px;
        transition: all 0.3s;
        background: white;
    }
    
    .search-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
    }
    
    .search-icon {
        position: absolute;
        left: 20px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--gray);
    }
    
    .filter-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }
    
    .filter-btn {
        padding: 12px 20px;
        border: 2px solid var(--border);
        background: white;
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        color: var(--gray);
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .filter-btn:hover {
        border-color: var(--primary);
        color: var(--primary);
    }
    
    .filter-btn.active {
        background: var(--primary);
        border-color: var(--primary);
        color: white;
    }
    
    .transactions-table {
        overflow-x: auto;
        border-radius: 15px;
        border: 1px solid var(--border);
        background: white;
    }
    
    table {
        width: 100%;
        border-collapse: collapse;
        min-width: 1200px;
    }
    
    thead {
        background: linear-gradient(135deg, #F9FAFB, #F3F4F6);
    }
    
    th {
        padding: 18px 20px;
        text-align: left;
        font-weight: 700;
        color: var(--dark);
        border-bottom: 2px solid var(--border);
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    td {
        padding: 18px 20px;
        border-bottom: 1px solid var(--border);
        vertical-align: middle;
    }
    
    tr:hover {
        background: #F9FAFB;
    }
    
    tr.status-pending-row {
        background: rgba(245, 158, 11, 0.05);
    }
    
    tr.status-completed-row {
        background: rgba(16, 185, 129, 0.05);
    }
    
    .service-badge {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 13px;
        font-weight: 700;
        color: white;
    }
    
    .bkash { background: var(--bkash); }
    .nagad { background: var(--nagad); }
    .rocket { background: var(--rocket); }
    .bank { background: var(--bank); }
    .other { background: var(--primary); }
    
    .transaction-id {
        font-family: 'Monaco', 'Courier New', monospace;
        font-weight: 700;
        color: var(--dark);
        font-size: 14px;
    }
    
    .amount {
        font-weight: 800;
        font-size: 18px;
    }
    
    .amount.received { color: var(--secondary); }
    .amount.sent { color: var(--danger); }
    
    .sender-info {
        display: flex;
        flex-direction: column;
    }
    
    .sender-number {
        font-weight: 700;
        color: var(--dark);
    }
    
    .sender-name {
        font-size: 13px;
        color: var(--gray);
        margin-top: 4px;
    }
    
    .balance {
        font-weight: 700;
        color: var(--primary);
        font-size: 16px;
    }
    
    .timestamp {
        color: var(--gray);
        font-size: 14px;
        white-space: nowrap;
    }
    
    .view-btn {
        background: linear-gradient(135deg, var(--primary), #7C3AED);
        color: white;
        border: none;
        padding: 10px 18px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s;
    }
    
    .view-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
    }
    
    .no-data {
        text-align: center;
        padding: 60px 20px;
        color: var(--gray);
    }
    
    .no-data i {
        font-size: 60px;
        margin-bottom: 20px;
        color: #E5E7EB;
    }
    
    .no-data h3 {
        font-size: 20px;
        margin-bottom: 10px;
        color: var(--dark);
    }
    
    .service-distribution {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 30px;
    }
    
    .service-item {
        background: white;
        padding: 20px;
        border-radius: 12px;
        border: 1px solid var(--border);
        display: flex;
        align-items: center;
        gap: 15px;
        transition: all 0.3s;
    }
    
    .service-item:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    
    .service-icon {
        width: 50px;
        height: 50px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 22px;
        color: white;
    }
    
    .service-count {
        font-weight: 800;
        font-size: 24px;
        color: var(--dark);
    }
    
    .service-name {
        font-size: 14px;
        color: var(--gray);
        font-weight: 600;
    }
    
    .footer {
        text-align: center;
        padding: 25px;
        color: rgba(255, 255, 255, 0.8);
        font-size: 14px;
        margin-top: 20px;
    }
    
    .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 1000;
        align-items: center;
        justify-content: center;
        padding: 20px;
    }
    
    .modal {
        background: white;
        border-radius: 20px;
        width: 100%;
        max-width: 600px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        animation: modalSlide 0.3s ease;
    }
    
    @keyframes modalSlide {
        from { opacity: 0; transform: translateY(-30px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .modal-header {
        padding: 25px 30px;
        border-bottom: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .modal-title {
        font-size: 22px;
        font-weight: 800;
        color: var(--dark);
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .close-btn {
        background: none;
        border: none;
        font-size: 24px;
        color: var(--gray);
        cursor: pointer;
        transition: color 0.3s;
    }
    
    .close-btn:hover {
        color: var(--danger);
    }
    
    .modal-body {
        padding: 30px;
    }
    
    .detail-row {
        display: flex;
        justify-content: space-between;
        padding: 16px 0;
        border-bottom: 1px solid var(--border);
    }
    
    .detail-label {
        font-weight: 600;
        color: var(--gray);
        font-size: 15px;
    }
    
    .detail-value {
        font-weight: 600;
        color: var(--dark);
        text-align: right;
        max-width: 60%;
        word-break: break-word;
    }
    
    .sms-preview {
        background: #F9FAFB;
        border-radius: 12px;
        padding: 25px;
        margin-top: 25px;
        border-left: 4px solid var(--primary);
    }
    
    .sms-title {
        font-size: 16px;
        font-weight: 700;
        color: var(--dark);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .sms-content {
        font-family: 'Monaco', 'Courier New', monospace;
        white-space: pre-wrap;
        background: white;
        padding: 20px;
        border-radius: 8px;
        border: 1px solid var(--border);
        max-height: 300px;
        overflow-y: auto;
        line-height: 1.8;
        font-size: 14px;
    }
    
    @media (max-width: 768px) {
        .header {
            flex-direction: column;
            gap: 20px;
            text-align: center;
        }
        
        .stats-grid {
            grid-template-columns: 1fr;
        }
        
        .action-bar {
            flex-direction: column;
            align-items: stretch;
        }
        
        .search-container {
            max-width: 100%;
        }
        
        .filter-buttons {
            justify-content: center;
        }
        
        .main-content {
            padding: 20px;
        }
    }
`;

document.head.appendChild(style);
